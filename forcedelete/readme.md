title: Forcedelete批处理介绍及注意事项
date: 2015-01-30 10:46:07
categories: [cmd, windows, tips]
tags: [cmd, windows, tips]
---

##Forcedelete批处理

用于Windows下删除各种疑难文件的批处理。

比如正常删除解决不了的就可以用它搞定，同时支持文件夹。

<!-- more -->

使用方法：
 > * 可以新建文本文档把代码贴进去，修改文件类型为.bat即可。
 > * 或者直接在这里下载bat文件 [Github][Github]

 > * 拖动需要删除的文件或文件夹到该bat文件上即可。

下面贴代码

``` cmd
DEL /F /A /Q \\?\%1 
RD /S /Q \\?\%1 
```

------
##解释一下这段代码

DEL 和 RD 为Windows系统命令行函数
详细的参数可以在cmd中输入 DEL/? 或 RD/?

cmd: 开始 -> 运行 -> 输入cmd回车

Del: 是专门用来删除单个文件的，其中
 > * /F 强制删除'只读'属性文件
 > * /A 删除'隐藏'等带其他属性的文件，对'只读'属性无效
 > * /Q 静默删除，无需确认

而 RD: 专门用来删除文件夹，其中
 > * /S 连带文件夹下全部文件一起删除
 > * /Q 静默删除无需确认

最后是路径名 `'\\?\%1 '`:

首先来说前半部分 `'\\?\'`：
这是一个特别协议的应用，这个特别协议就是`UNC` -- Universal Naming Convention) ，中文是“[通用命名规则][通用命名规则-baike]”

 > 对于网络服务器上的目标文件，可使用“通用命名约定 (UNC)” （UNC：“统一命名约定”地址，用于确定保存在网络服务器上的文件位置。这些地址以两个反斜线 (\\\\)开头，并提供服务器名、共享名和完整的文件路径。）地址。这些地址以“file:\\\”开始并提供服务器名、共享名和文件的完整路径。例如，“file:\\\server\share\path\project file.mpp”是绝对 UNC 地址

这里的`file:`可以省略
`server`在本地操作中用`'.'`代替
就构成了表示`'操作系统本地路径'`的 `'\\?\'`！

而后半部分的 `'%1 '` 表示第一个参数，也就是我们进行拖动操作后传入的绝对路径。

至此该代码的内容已经解释完毕。接下来是**十分重要的注意事项**   //这里是高能预警

------

注意事项：

##在文件名包含某些特殊字符时有误删除的潜在危险！

[参考自卡饭论坛][参考自卡饭论坛]
 > 设h:是一个u盘，下面有一个fdel.bat:
 > 
 > DEL /F /A /Q \\?\%1
 > RD /S /Q \\?\%1
 > 
 > 同时h:下还有一个名为 &1.txt  的文本文件，此时
 > 你想用 fdel.bat 删除 &1.txt，当你把 &1.txt 拖到
 > fdel.bat 上后，h:下的所有的文件和文件夹将全部不复存在。。。
 > 
 > 这正是特殊字符"&"(另："^&"也有类似效果)的作用了（执行的时候变成了rd /s /q \\?\"h:\&1.txt"，&的前后会并列，于是h:\被清空，然后才是定位1.txt以便删除。

 > **该bat很强大很简洁，但是一定不要用于删除文件名中（尤其是文件名首字符为&或^&）的文件或文件夹，否则可能造成误删除。**

------

Have fun!
[文章链接:潘雄飞的博客][潘雄飞的博客]

[潘雄飞的博客]:http://piratf.github.io/
[Github]:https://github.com/piratf/Mytools
[通用命名规则-baike]:http://baike.baidu.com/view/244940.htm
[参考自卡饭论坛]:http://bbs.kafan.cn/thread-544402-1-1.html